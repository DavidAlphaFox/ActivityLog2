2016-09-13  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/edit-lap-swim.rkt (swl-model%/can-join?): check for matching
	stroke types.

2016-09-06  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/edit-session-summary.rkt
	(edit-session-summary-dialog%/insert-session): fix call to
	'maybe-update-session-tss'

2016-09-05  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/database.rkt (db-extract-length): don't load the
	trackpoints, makes the application load faster and they are not
	used anywhere anymore.

	* rkt/data-frame.rkt (data-series%/get-index): don't return #f
	when the first item is found.

	* rkt/about-frame.rkt (make-about-frame): use a text% object and
	lock it, allows selecting the text (but not modifying it)

2016-09-01  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/inspect-quadrant.rkt (quadrant-plot-panel%): don't try to
	compute threshold values and zone renderers if yval-fn is not
	defined.

2016-08-31  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/session-df.rkt (add-pace-series): don't do smoothing at
	startup if data is too short or contains invalid values.
	(add-elapsed-series): make sure the series always grows (swim
	activities only)

	* rkt/data-frame.rkt (data-series%/get-index): return #f if
	searched value is out of range.
	(df-quantile): be careful of bad data like zero length ranges, 0
	weight values, etc
	(df-quantile contract): function can also return #f

2015-05-26  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-calendar.rkt: refactoring and cleanup

2015-05-20  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/fit-file.rkt (fit-output-stream%/put-message): raise error
	with correct message
	(fit-sport-file%): new class

	* rkt/widgets.rkt (this-day-end): new defun
	(*time-periods*): use `this-day-end' instead of `current-seconds'

	* rkt/view-athlete-metrics.rkt
	(make-athlete-metrics-summary-label): new defun
	(view-athlete-metrics%/on-filter-changed): update status line

2015-05-08  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (make-edit-menu): add Edit/Edit Seasons... menu

	* rkt/edit-seasons.rkt: new file

2015-05-06  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-athlete-metrics.rkt (athlete-metrics-operations<%>):
	new interface
	(athlete-metrics-operations-menu%): allow the menu to be created
	on the menu bar as well as a pop-up menu
	(view-athlete-metrics%): implement the
	athlete-metrics-operations<%> interface.

	* rkt/toplevel.rkt (make-edit-menu): move the "Edit sport zones"
	item into the "Athlete" menu.
	(make-athlete-menu): new defun
	(athlete-metrics-forwarder%): new class
	(toplevel-window%): create an athlete-metrics-forwarder%

2015-05-04  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (make-activtiy-menu): send activity operations
	to the forwarder
	(activity-operations-forwarder%): new class

2015-04-22  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/plot-axis-def.rkt (extract-hr): return 0 if there is no HR
	info
	(extract-torque, axis-cadence)
	(axis-vertical-oscillation, axis-stance-time)
	(axis-stance-time-percent, axis-power, axis-left-right-balance)
	(axis-left-torque-effectiveness)
	(axis-right-torque-effectiveness, axis-torque-effectiveness)
	(axis-left-pedal-smoothness, axis-right-pedal-smoothness)
	(axis-pedal-smoothness): extractors return 0 if there is no data
	in the current track point.

	* rkt/database.rkt (db-row->alist): reverted earlier change

	* sql/p7-seasons.sql: new file

	* sql/db-schema.sql(SEASON): new db table, db schema updated to
	version 7

	* rkt/widgets.rkt (*time-periods*): add 'seasons special entry
	(date-range-selector%): add a seasons choice box which shows up
	when 'seasons is selected
	(date-range-selector%/set-seasons): setup the season definitions

	* rkt/view-reports.rkt (view-reports%): initialize the season data

	* rkt/view-pmc.rkt (view-pmc%): initialize the season data

	* rkt/view-athlete-metrics.rkt (view-athlete-metrics%): initialize
	the season data

	* rkt/view-activities.rkt (view-activities%): initialize the
	season data

	* rkt/database.rkt(db-get-seasons): new defun

2015-04-20  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* sql/db-schema.sql: add IX0_SECTION_SUMMARY

	* rkt/plot-builder.rkt (plot-builder%/get-plot-renderer):
	uncontidionally remove zeroes from scatter plots.

	* rkt/database.rkt (db-row->alist): allow null values to be
	collected, with a specified replacement value
	(db-extract-trackpoint): extract trackpoints with null values, and
	convert these to 0

	* rkt/map-widget.rkt (select-zoom-level): select the max zoom
	level when the bounding box is too small

	* rkt/view-pmc.rkt (view-pmc%/on-date-range): increase the backlog
	of days for the PMC to get more accurate data for short periods

2015-04-17  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-reports.rkt (sql-column-ref): new defun
	(am-query-template, make-am-query, get-athlete-metrics)
	(get-athlete-metrics-sql, am-columns, get-am-columns): new defuns
	(view-reports%): add new athlete metric reports

	* rkt/inspect-graphs.rkt (torque-effectiveness-graph%): add
	combined torque effectiveness data series
	(pedal-smoothness-graph%): add combined pedal smoothness data
	series

	* rkt/plot-axis-def.rkt (axis-torque-effectiveness)
	(axis-pedal-smoothness): new axis definitions

	* rkt/activity-util.rkt (session-avg-torque-effectiveness)
	(session-avg-pedal-smoothness): new defuns

2015-04-15  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-athlete-metrics.rkt (get-athlete-metrics-sql-query):
	new function
	(get-athlete-metrics): use `get-athlete-metrics-sql-query' for the
	sql query
	(view-athlete-metrics%/on-interactive-export-sql-query): new
	method

2015-04-13  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (toplevel-window%): add an "Athlete Metrics"
	section

	* sql/db-schema.sql (E_SLEEP_QUALITY, E_OVERALL_FEELING)
	(ATHLETE_METRICS): new db tables

	* sql/p6-athlete-metrics.sql: new file

	* rkt/fmt-util.rkt (weight->string): new defun

	* rkt/edit-athlete-metrics.rkt: new file

	* rkt/view-athlete-metrics.rkt: new file

2015-04-07  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-pmc.rkt (produce-pmc-data): use a exponentially
	weighted moving average
	(produce-pmc-data): beter ctl-alpha and atl-alpha values

2015-04-06  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/fit-file.rkt (bstr->integer): bugfix: read negative int8
	values correctly.
	(activity-builder%/collect-summary-data): add cycling dynamics
	fields

	* rkt/fit-defs.rkt (*record-fields* *lap-fields*)
	(*session-fields*, *lap-conversions*): add cycling dynamics
	fields.

	* rkt/activity-util.rkt (compute-summary-data): handle the case
	when total-timer-time is 0

2015-03-24  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/fit-file.rkt (fit-output-file%): convert time-created to fit
	epoch before writing it.

2015-03-23  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/fit-file.rkt (fit-output-file%, fit-workout-file%): new
	classes

	* rkt/fit-defs.rkt (*global-message-number*): add hr-zone,
	speed-zone, power-zone, zones-target and user-profile messages
	plus all their fields and conversions

	* rkt/plot-axis-def.rkt (axis-swim-avg-cadence): compute a
	fractional cadence.

	* rkt/database.rkt (db-delete-session): delete labels and weather
	data.

2015-03-19  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/fit-file.rkt (compute-crc): renamed from `fit-compute-crc'
	and fixed bug (how did this ever work?), plus updated to be able
	to compute the CRC for a subset of the buffer.
	(real->bstr): renamed from real->floating-point-bytes-1
	(integer->bstr): new function
	(fit-types): updated with new writer functions
	(get-fit-type): new function, moved out of `fit-data-stream%`
	(fit-output-stream%): new class

	* rkt/fit-defs.rkt (unix-time->fit-time): new function

2015-03-18  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* test/db-test.rkt: new test case "Get Sport Zones"

2015-03-10  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (toplevel-window%/on-toplevel-close): Save the
	frame dimensions and maximized state
	(toplevel-window%): when creating the toplevel frame, restore its
	previous dimensions

	* rkt/view-session.rkt (session-header%/switch-to-edit-mode):
	focus the headline edit field

2015-03-06  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/fit-file.rkt (write-one-fit-value): new function
	(write-fit-value): new function

	* rkt/fit-defs.rkt (*event-name*): add new event names 

2015-03-05  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (make-tools-menu): add an "Optimize
	database..." menu item
	(toplevel-window%/vacuum-database): new function

	* rkt/map-widget.rkt (vacuum-tile-cache-database): new function

2015-03-04  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/plot-axis-def.rkt (axis-grade): force zero start

2015-03-02  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/map-util.rkt (bbox-size): return (values width height),
	instead of the other way around.

2015-03-03  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-calendar.rkt (the-small-font): make it 7 point height
	(make-badge): new function for drawing badges.
	(calendar-item-snip%): use make-badge
	(*cell-inset*): reduce it to 3 pixels
	(*cell-header-height-pct*): increase it to 0.15
	(calendar-pb%/on-select): put selected snip first.

2015-02-27  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/sport-charms.rkt (get-zone-definition-id): bugfix, accept #f
	as the sport arg.

2015-02-26  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/activity-util.rkt (session-total-vertical-travel): new
	function

2015-02-24  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/inspect-map.rkt (map-panel%): more compact layout

	* rkt/inspect-graphs.rkt (graph-panel%): more compact layout

	* rkt/map-widget.rkt (draw-map-legend): use an imperial measures
	if configured

2015-02-23  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (make-edit-menu): add the "Edit preferences"
	menu item.

	* rkt/weather.rkt (al-pref-wu-api-key): new parameter, replaces
	wu-api-key
	(al-pref-allow-weather-download): new parameter, replaces
	allow-weather-download

	* rkt/map-widget.rkt (al-pref-allow-tile-download): new parameter,
	replaces allow-tile-download

	* rkt/fmt-util.rkt (al-pref-measurement-system): new parameter,
	replaces measurement-system

	* rkt/edit-preferences.rkt: new file

2015-02-20  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/activity-edit.rkt (activity-operations-menu%): add Ctrl+E
	and Ctrl+N menu shortcuts for "Edit" and "New Activity"

	* rkt/view-reports.rkt (view-reports%): date-range-field, new
	class level field
	(view-reports%/refresh): refresh the date range as well

	* rkt/view-activities.rkt (view-activities%): date-range-field,
	new class level field
	(view-activities%/refresh): refresh the date range as well

2015-02-12  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/inspect-graphs.rkt (cadence-graph%): call stride->string
	with the correct parameters (bugfix)

2015-02-10  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/import.rkt (import-new-activities-from-directory): new function.
	(fixup-old-style-equipment-serial): renamed to
	`update-old-style-equipment-serial', also SQL query changed.
	(fixup-equipment-part-of): renamed to `update-equipment-part-of'
	(fixup-elevation-for-new-sessions): renamed to
	`update-elevation-for-new-sessions'

	* rkt/import-view.rkt (import-dialog%): renamed 'do-import' to
	'run', an import directory can now be specified.

	* rkt/toplevel.rkt (toplevel-window%): on-import-from-directory
	implemented.

2015-02-04  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/view-activities.rkt (*activity-list-display-columns*): add
	humindex as one of the columns.

	* rkt/inspect-overview.rkt (*weather-fields*): add humindex as one
	of the fields

	* rkt/weather.rkt (humindex): new function

	* rkt/al-widgets.rkt (sport-selector% set-selected-sport): account
	for the sub-sport being 0 and treat it as #f

2015-02-03  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt: bring it up to date with the renames

	* rkt/reports.rkt renamed to rkt/view-reports.rkt
	* rkt/session-view.rkt renamed to rkt/view-session.rkt
	* rkt/activity-list.rkt renamed to rkt/view-activities.rkt
	* rkt/calendar.rkt renamed to rkt/view-calendar.rkt
	* rkt/equipment.rkt renamed to rkt/view-equipment.rkt

	class names also renamed, for consistent naming


2015-02-02  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/reports.rkt (reports-view%): remove stray #\` character

2015-01-28  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/inspect-overview.rkt (inspect-overview-panel%): add an
	auto-hscroll to the canvas

	* rkt/toplevel.rkt (toplevel-window%): added import menu options,
	moved the export menu options from the View menu into the File
	menu.
	(on-import-activity): implemented

	* rkt/database.rkt (db-delete-activity-hard): delete the row from
	the LAST_IMPORT table before deleting the activity.

2015-01-27  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/toplevel.rkt (make-file-menu): new function
	(toplevel-window%): on-exit, on-new-database, on-open-database,
	new methods

2015-01-19  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/widgets.rkt (qresults-list%): rename interactive-export-data
	to on-interactive-export-data for consistency
	(qresults-list%): implement an interactive-export-data method, to
	data exporting works again.

	* rkt/view-pmc.rkt (view-pmc%): new functions, export-data-as-csv,
	on-interactive-export-data

	* rkt/toplevel.rkt (make-view-menu): allow invoking "export data"
	on objects that have an interactive-export-data method.

2015-01-15  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/equipment.rkt (*service-log-display-columns*): make sure we
	handle corectly sql null values.

2015-01-14  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/edit-session-tss.rkt: new file, hooked into all places that
	need TSS calculations

2015-01-11  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/reports.rkt (tvol-query): changed the way average power and
	normalized power is calculated, to better match the "average"

2015-01-05  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/import.rkt (fixup-garmin-swim-activities): update swim
	activities from FR920 too

2015-01-07  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/database.rkt (maybe-create-schema): only delete the database
	on failure when the database is created on disk

	* test/db-test.rkt: new file

	* rkt/import.rkt (fixup-garmin-swim-activities): removed, as the
	swim activity sub-type is now correctly read.

	* rkt/fit-file.rkt (fit-event-dispatcher%): new method, on-sport
	(activity-builder%): on-sport saves the sport fields, on-session
	collects the sport from the sport field if available.

	* rkt/fit-defs.rkt (*global-message-number*): add sport message
	(*sport-fields*): new definition
	(*field-db*): add the sport message
	(*sport-conversions*): new definition
	(*field-conversion-db*): add conversions for sport message fields

	* rkt/activity-edit.rkt (weather-edit%): be more tolerant of bad
	wobs data

2015-01-04  Alex Harsanyi  <AlexHarsanyi@gmail.com>

	* rkt/widgets.rkt (convert-to-date): limit years to sensible range

